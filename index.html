<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üé∞ College Casino</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: radial-gradient(circle at center, #222, #000);
      color: white;
      text-align: center;
      overflow-x: hidden;
    }
    h1 { color: gold; text-shadow: 0 0 10px orange; }
    .slot {
      display: flex; justify-content: center; margin: 20px;
    }
    .reel {
      font-size: 50px;
      margin: 10px;
      width: 70px;
      height: 70px;
      border: 2px solid gold;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      background: rgba(255,255,255,0.1);
      box-shadow: 0 0 15px gold inset;
    }
    button {
      background: gold;
      border: none;
      border-radius: 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      margin-top: 20px;
      transition: 0.3s;
    }
    button:hover { background: orange; transform: scale(1.05); }
    table {
      margin: 30px auto;
      border-collapse: collapse;
      width: 80%;
    }
    th, td {
      border: 1px solid #555;
      padding: 8px;
    }
    th { background: #333; }
    tr:nth-child(even) { background: rgba(255,255,255,0.05); }
  </style>
</head>
<body>

<h1>üé∞ College Casino üéâ</h1>
<div class="slot">
  <div class="reel" id="r1">üçí</div>
  <div class="reel" id="r2">üçã</div>
  <div class="reel" id="r3">üçá</div>
</div>

<button onclick="spin()">–ö—Ä—É—Ç–∏—Ç—å üé≤</button>

<h2 id="message"></h2>

<h3>üèÜ –¢–∞–±–ª–∏—Ü–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π</h3>
<table id="results">
  <thead>
    <tr><th>–ò–º—è</th><th>–ü–æ–ø—ã—Ç–∫–∏</th><th>–î–∞—Ç–∞</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let tries = 0;
const symbols = ["üçí","üçã","üçá","üçâ","‚≠ê","üíé"];

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
async function loadResults() {
  try {
    const res = await fetch("results.json?cache=" + Date.now());
    if (!res.ok) throw new Error("HTTP " + res.status);
    const data = await res.json();
    const tbody = document.querySelector("#results tbody");
    tbody.innerHTML = "";
    data.reverse().forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${row.name}</td><td>${row.tries}</td><td>${row.date}</td>`;
      tbody.appendChild(tr);
    });
  } catch(e) {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ results.json:", e);
  }
}

// –ö—Ä—É—Ç–∏–ª–∫–∞
async function spin() {
  tries++;
  const r1 = document.getElementById("r1");
  const r2 = document.getElementById("r2");
  const r3 = document.getElementById("r3");
  const reels = [r1, r2, r3];
  const spins = [10, 15, 20].map(s => s + Math.floor(Math.random()*5));

  for (let i = 0; i < Math.max(...spins); i++) {
    reels.forEach((reel, idx) => {
      if (i < spins[idx]) {
        reel.textContent = symbols[Math.floor(Math.random()*symbols.length)];
      }
    });
    await new Promise(r => setTimeout(r, 100));
  }

  const [a, b, c] = reels.map(r => r.textContent);
  if (a === b && b === c) {
    const name = prompt("üéâ –ü–æ–±–µ–¥–∞! –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:");
    if (name) {
      document.getElementById("message").textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, ${name}! üçÄ`;
      await sendResult(name, tries);
      tries = 0;
    }
  } else {
    document.getElementById("message").textContent = "–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!";
  }
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤ GitHub (repository_dispatch)
async function sendResult(name, tries) {
  const result = { name, tries, date: new Date().toLocaleString() };
  try {
    const resp = await fetch("https://api.github.com/repos/BodSeb/College-casino/dispatches", {
      method: "POST",
      headers: {
        "Accept": "application/vnd.github+json",
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        event_type: "update_results",
        client_payload: result
      })
    });
    if (!resp.ok) throw new Error("HTTP " + resp.status);
    alert("–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
    loadResults();
  } catch (e) {
    console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:", e);
    alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç");
  }
}

loadResults();
</script>

</body>
</html>