<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé∞ College Casino</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: radial-gradient(circle at center, #222, #000);
    color: white;
    text-align: center;
    overflow-x: hidden;
  }
  h1 { color: gold; text-shadow: 0 0 10px orange; }
  .slot {
    display: flex; justify-content: center; margin: 20px;
  }
  .reel {
    font-size: 50px;
    margin: 10px;
    width: 70px;
    height: 70px;
    border: 2px solid gold;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    background: rgba(255,255,255,0.1);
    box-shadow: 0 0 15px gold inset;
  }
  button {
    background: gold;
    border: none;
    border-radius: 10px;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
    margin-top: 20px;
  }
  button:hover { background: orange; }
  table {
    margin: 30px auto;
    border-collapse: collapse;
    width: 80%;
  }
  th, td {
    border: 1px solid #555;
    padding: 8px;
  }
  th { background: #333; }
  tr:nth-child(even) { background: rgba(255,255,255,0.05); }
</style>
</head>
<body>

<h1>üé∞ College Casino üéâ</h1>
<div class="slot">
  <div class="reel" id="r1">üçí</div>
  <div class="reel" id="r2">üçã</div>
  <div class="reel" id="r3">üçá</div>
</div>

<button onclick="spin()">–ö—Ä—É—Ç–∏—Ç—å üé≤</button>

<h2 id="message"></h2>

<h3>üèÜ –¢–∞–±–ª–∏—Ü–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–π</h3>
<table id="results">
  <tr><th>–ò–º—è</th><th>–ü–æ–ø—ã—Ç–∫–∏</th><th>–î–∞—Ç–∞</th></tr>
</table>

<script>
let tries = 0;
const symbols = ["üçí","üçã","üçá","üçâ","‚≠ê","üíé"];

async function loadResults() {
  try {
    const res = await fetch("results.json?cache=" + Date.now());
    const data = await res.json();
    const table = document.getElementById("results");
    data.reverse().forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${row.name}</td><td>${row.tries}</td><td>${row.date}</td>`;
      table.appendChild(tr);
    });
  } catch(e) { console.error(e); }
}

async function spin() {
  tries++;
  const r = [r1, r2, r3];
  r.forEach(reel => reel.textContent = symbols[Math.floor(Math.random()*symbols.length)]);
  document.getElementById("message").textContent = "–ö—Ä—É—Ç–∏–º...";
  
  await new Promise(res => setTimeout(res, 800));
  
  const a = r1.textContent, b = r2.textContent, c = r3.textContent;
  if (a === b && b === c) {
    const name = prompt("üéâ –ü–æ–±–µ–¥–∞! –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:");
    document.getElementById("message").textContent = `–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, ${name}! üçÄ`;
    sendResult(name, tries);
    tries = 0;
  } else {
    document.getElementById("message").textContent = "–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë!";
  }
}

async function sendResult(name, tries) {
  const result = { name, tries, date: new Date().toLocaleString() };
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ, —Ç–æ–∫–µ–Ω Action –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∞–º
  await fetch("/.netlify/functions/sendResult", { // –ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å serverless
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(result)
  }).catch(e => console.log("–û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ repository_dispatch", e));

  // –ï—Å–ª–∏ —Ö–æ—á–µ—à—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ GitHub API:
  await fetch("https://api.github.com/repos/BodSeb/College-casino/dispatches", {
    method: "POST",
    headers: {
      "Accept": "application/vnd.github+json",
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      event_type: "update_results",
      client_payload: result
    })
  });

  alert("–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!");
}

loadResults();
</script>

</body>
</html>
